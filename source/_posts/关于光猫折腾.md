---
title: 关于光猫折腾
date: 2023-12-24 01:15:40
tags:
---
# pppoe

```
PPP over Ethernet，数字用户线路DSL（Digital Subscriber Line）是以电话线为传输介质的传输数字信号的技术，人们通常把所有的DSL技术统称为xDSL，x代表不同种类的数字用户线路技术。目前比较流行的宽带接入技术为ADSL，ADSL时非对称DSL技术，使用是PPPoE协议。

PPPoE协议通过在以太网上提供点到点的连接，建立PPP会话，使的以太网中的主机能够连接到远端的宽带接入服务器上。PPPoE具有使用范围广、安全新高、计费方便等特点。

PPP为二层协议，Ethernet为二层协议，PPPoE为将Ethernet跑在PPP的协议之上，PPP报文具有认证功能，所以将PPP封装以太网包中，让PPP协议在以太网环境中对设备进行认证、计费等功能，而PPP不支持广播发送的能力，所以不能完成PPOE认证的过程，所以将PPP跑在Enternet之上，使用PPP进行认证和IP地址的分发，使用Enternet技术实现广播的发送。
```

<!--more-->

## 	目的

```
## 

运营商希望把一个站点上的多台主机连接到同一台远程接入设备，同时接入设备能够提供与拨号上网类似的访问控制和计费功能。在众多的接入技术中，把多个主机连接到接入设备的最经济的方法就是以太网，而PPP协议可以提供良好的访问控制和计费功能，于是产生了在以太网上传输PPP报文的技术，即PPPoE。

PPPoE利用以太网将大量主机组成网络，通过一个远端接入设备连入因特网，并运用PPP协议对接入的每个主机进行控制，具有适用范围广、安全性高、计费方便的特点
```

## 3.PPPoE拨号的过程

![img](https://pics0.baidu.com/feed/c8ea15ce36d3d5396b930547de75b357372ab086.jpeg@f_auto?token=3fda7fea6e5b5bba5673e6274311af30)

### 3.1.Discovery阶段

1)PPPoE Client广播发送一个PADI（PPPoE Active Discovery Initial）报文，在此报文中包含PPPoE Client想要得到的服务类型信息。

2)所有的PPPoE Server收到PADI报文之后，将其中请求的服务与自己能够提供的服务进行比较，如果可以提供，则单播回复一个PADO（PPPoE Active Discovery Offer）报文。

3)根据网络的拓扑结构，PPPoE Client可能收到多个PPPoE Server发送的PADO报文，PPPoE Client选择最先收到的PADO报文对应的PPPoE Server做为自己的PPPoE Server，并单播发送一个PADR（PPPoE Active Discovery Request）报文。

4)PPPoE Server产生一个唯一的会话ID（Session ID），标识和PPPoE Client的这个会话，通过发送一个PADS（PPPoE Active Discovery Session-confirmation）报文把会话ID发送给PPPoE Client，会话建立成功后便进入PPPoE Session阶段。

完成之后通信双方都会知道PPPoE的Session_ID以及对方的以太网地址，它们共同确定了唯一的PPPoE Session。

### 3.2.Session阶段

PPPoE Session上的PPP协商和普通的PPP协商方式一致，分为LCP、认证、NCP三个阶段。

1)LCP阶段主要完成建立、配置和检测数据链路连接。

2)LCP协商成功后，开始进行认证，认证协议类型由LCP协商结果（CHAP或者PAP）决定。

3)认证成功后，PPP进入NCP阶段。NCP是一个协议族，用于配置不同的网络层协议，常用的是IP控制协议（IPCP），它主要负责协商用户的IP地址和DNS服务器地址。

PPPoE Session的PPP协商成功后，就可以承载PPP数据报文。

在PPPoE Session阶段所有的以太网数据包都是单播发送的。

### 3.3.Terminate阶段

PPP通信双方可以使用PPP协议自身来结束PPPoE会话，当无法使用PPP协议结束会话时可以使用PADT（PPPoE Active Discovery Terminate）报文。

进入PPPoE Session阶段后，PPPoE Client和PPPoE Server都可以通过发送PADT报文的方式来结束PPPoE连接。PADT数据包可以在会话建立以后的任意时刻单播发送。在发送或接收到PADT后，就不允许再使用该会话发送PPP流量了。

ADEL